+function(t){function e(e,o){this.element=e,this.pageChanged=!1,this.opts=o,this.modal=t('<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="mjax"></div>'),this.modalDoc=t('<div class="modal-dialog" role="document"></div>'),this.modalContent=t('<div class="modal-content"></div>'),this.modalHeader=t('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>'),this.modalHeaderTitle=t('<h4 class="modal-title">Modal title</h4>'),this.modalBody=t('<div class="modal-body"></div>'),this.modalFooter=t('<div class="modal-footer"><button type="button" class="btn btn-default" data-dismiss="modal">Close</button></div>'),this.modal.append(this.modalDoc),this.modalDoc.append(this.modalContent),this.modalContent.append(this.modalHeader).append(this.modalBody),this.modalHeader.append(this.modalHeaderTitle),this.modalBody.css({padding:"1px 0"});var a=this;this.modal.on("hidden.bs.modal",function(){a.pageChanged&&a.opts.refresh&&o.close.call(a),a.destroy()})}t.fn.modal&&(t.fn.modal.Constructor.prototype.enforceFocus=function(){});var o={"X-Mjax-Request":"1.0.1"};e.prototype.updateBody=function(){this.modalBody.find(".mjax").mjax(this.opts);var e=this;this.modalBody.find("form").each(function(){var a=t(this);a.off("submit"),a.on("submit",function(a){return a.result=!1,t(this).ajaxSubmit({headers:o,beforeSubmit:function(){e.opts.beforeSubmit.call(e)},complete:function(t){e.processRedirect(t,!0,!1),e.opts.submitComplete.call(e)},success:function(t){e.extractContent(t),e.pageChanged=!0,e.opts.submitSuccess.call(e)}}),!1})})},e.prototype.processRedirect=function(t,e,o){var a=this;if(309==t.status){var i=t.getResponseHeader("X-Mjax-Redirect");a.mjaxGet(i,function(t){a.extractContent(t),a.pageChanged=e,o&&a.show()})}},e.prototype.show=function(){var t=this.element.data("mjax-size");this.modalDoc.removeClass("modal-lg").removeClass("modal-sm"),"sm"==t?this.modalDoc.addClass("modal-sm"):"lg"==t&&this.modalDoc.addClass("modal-lg"),this.modal.modal({backdrop:"static"})},e.prototype.destroy=function(){this.opts=null,this.modal.remove(),this.modalDoc.remove(),this.modalContent.remove(),this.modalHeader.remove(),this.modalHeaderTitle.remove(),this.modalBody.remove(),this.modalFooter.remove()},e.prototype.mjaxGet=function(e,a){var i=this;return t.ajax({url:e,type:"get",complete:function(t){i.processRedirect(t,!1,!0)},success:a,headers:o})},e.prototype.extractContent=function(e){var o=t(t.parseHTML(e,document,!0)),a=this.findAll(o,"script").remove(),i=this.findAll(o,"link").remove();o=o.not(a).not(i),this.modalBody.empty().html(o);var s=this;t.when(s.executeTags(i,"link","href",!0),s.executeTags(a,"script","src",!0)).done(function(){s.updateBody()})},e.prototype.findAll=function(t,e){return t.filter(e).add(t.find(e))},e.prototype.executeTags=function(e,o,a,i){if(!e)return!1;var s=t.Deferred(),d=t(o+"["+a+"]"),n=this,l=function(e){var o=this[a];d.filter(function(){return this[a]===o}).length?e():o?(i&&t.getScript(o).done(e).fail(e),document.head.appendChild(this)):(n.modalBody.append(this),e())},r=0,m=function(){if(r>=e.length)s.resolve();else{var t=e[r];r++,l.call(t,m)}};return m(),s},t.fn.mjax=function(o){var a=t.extend({},t.fn.mjax.DEFAULTS,o);return this.each(function(){var o=t(this),i=o.data("mjax-refresh");void 0!=i&&(a.refresh=i),o.data("mjax-bind")?o.off("click.mjax"):o.data("mjax-bind",!0),o.on("click.mjax",function(i){var s=new e(t(this),a);i.preventDefault(),a.beforeOpen.call(s),o.attr("title")?s.modalHeaderTitle.html(o.attr("title")):s.modalHeaderTitle.html(o.html()),s.mjaxGet(o.attr("href"),function(t){s.extractContent(t),a.beforeShow.call(s),s.show()})})})},t.fn.mjax.DEFAULTS={refresh:!1,beforeSubmit:t.noop,submitComplete:t.noop,submitSuccess:t.noop,beforeOpen:t.noop,beforeShow:t.noop,close:function(){window.location.reload()}},t(document).ready(function(){t(".mjax").mjax()})}(jQuery);